{
    "key": "filtre-notranslate",
    "name": "Notranslate LaTeX",
    "category": "filtres",
    "instructions": "Aquest filtre encapsula les fòrmules LaTeX amb la classe notranslate per evitar que Google les tradueixi.",
    "filter": "var inlineRegex2 = /\\\\\\(((?:.|\\n)+?)\\\\\\)/mgi; var displayRegex2 = /\\\\\\[((?:.|\\n)+?)\\\\\\]/mgi; var formulaRegex = /((?:\\\\\\[|\\\\\\()(?:.|\\n)+?(?:\\\\\\]|\\\\\\)))/mgi; var formulesOk = 0; var filterFn = function(node) {\n     if(node.textContent.match(inlineRegex2) || node.textContent.match(displayRegex2)) {\n     var elem = node.parentElement;\n     if(!elem.classList.contains(\"notranslate\") && !elem.closest(\".notranslate\")) {\n          return 1;\n     }\n     formulesOk += 1;\n     return -1;\n     }\n     return 0;\n}; var n, walker = document.createTreeWalker(editor.getBody(), NodeFilter.SHOW_TEXT, null, false); var formulesPendents = 0;  var toTreat = []; var toFixNested = []; while(n=walker.nextNode()) {\n          const res = filterFn(n);\n          if(!res) {continue;}\n          if(res > 0) {\n               toTreat.push(n);\n          } else {\n               toFixNested.push(n.parentElement);\n          }\n     }\n     toTreat.forEach(function(n) {\n          var elem = n.parentElement;\n          var parts = n.textContent.split(formulaRegex);\n          parts.forEach(txt => {\n          if(txt.match(formulaRegex)) {\n          var span = document.createElement('span');\n          span.innerHTML = txt;\n          span.classList.add('notranslate');\n          elem.insertBefore(span, n);\n          } else {\n          var txtNode = document.createTextNode(txt);\n          elem.insertBefore(txtNode, n);\n          }\n          });\n          elem.removeChild(n);\n          formulesPendents++;\n     });\n     toFixNested.forEach(function(elem) {\n     var currentElem = elem;\n     while(currentElem && currentElem.nodeName===\"SPAN\" &&\n          currentElem.classList.contains(\"notranslate\") && currentElem.parentElement && \n          Array.from(currentElem.parentElement.childNodes).filter(function(n){return n.nodeName!=='#text' || n.textContent.trim()!=='';}).length==1 &&\n          currentElem.parentElement.classList.contains(\"notranslate\")) {\n          currentElem = currentElem.parentElement;\n     }\n     if(currentElem!=elem) {\n          currentElem.innerHTML = elem.innerHTML;\n          formulesPendents +=1;\n     }\n     });\nvar total = formulesPendents + formulesOk; var msg_stats = \"S'han detectat \" + total + \" fòrmules i s'han corregit \"+formulesPendents; var markUpdated = formulesPendents > 0; return [markUpdated, msg_stats];\n",
    "forids": "31,794,5806,11378",
    "stars": 1,
    "author": "Josep Mulet Pol <pep.mulet@gmail.com>",
    "version": "2022.09.28"
}