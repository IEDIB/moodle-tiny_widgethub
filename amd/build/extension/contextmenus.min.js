define("tiny_ibwidgethub/extension/contextmenus",["../extension","../service/userstorage_service","../util","./contextactions"],(function(_extension,_userstorage_service,_util,Action){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Action=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}
/**
   * Tiny WidgetHub plugin.
   *
   * @module      tiny_ibwidgethub/plugin
   * @copyright   2024 Josep Mulet Pol <pep.mulet@gmail.com>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */(Action);const SUPPORTED_LANGS=[{iso:"ca",title:"Català"},{iso:"es",title:"Castellà"},{iso:"en",title:"English"},{iso:"fr",title:"Francès"},{iso:"de",title:"Alemany"}],AVAILABLE_EFFECTS=[{name:"zoom",title:"Zoom"},{name:"lightbox",title:"Pantalla completa"}],SUPPORTED_SIZES=[{v:"gran",l:"Gran"},{v:"mitjana",l:"Mitjana"},{v:"petita",l:"Petita"}];(0,_extension.registerMenuItemProvider)((function(ctx){const openInputDialog=function(title,label,initialValue,onSubmit){var _ctx$editor;null===(_ctx$editor=ctx.editor)||void 0===_ctx$editor||_ctx$editor.windowManager.open({title:title,body:{type:"panel",items:[{type:"input",name:"value",label:label}]},buttons:[{type:"submit",text:"Acceptar"}],initialData:{value:initialValue},onSubmit:onSubmit})},imageEffectsNestedMenu={name:"imageEffects",condition:"imatge",title:"Efectes d'imatge",subMenuItems:()=>{var _ctx$path;const elem=null===(_ctx$path=ctx.path)||void 0===_ctx$path?void 0:_ctx$path.elem;return elem?elem.getAttribute("data-snptd")?[{type:"menuitem",icon:"remove",text:"Treure",onAction:Action.removeImageEffectsAction.bind({ctx:ctx})}]:AVAILABLE_EFFECTS.map((e=>({type:"menuitem",text:e.title,onAction:Action.addImageEffectAction.bind({ctx:ctx,type:e.name})}))):""}},imageSwitchToSnippet={name:"imageSwitchToSnippet",condition:()=>{var _ctx$path2,_ctx$path2$widget,_ctx$path3,_elem$classList;const key=null===(_ctx$path2=ctx.path)||void 0===_ctx$path2||null===(_ctx$path2$widget=_ctx$path2.widget)||void 0===_ctx$path2$widget?void 0:_ctx$path2$widget.key,elem=null===(_ctx$path3=ctx.path)||void 0===_ctx$path3?void 0:_ctx$path3.selectedElement,isImg=void 0!==key&&"imatge"!==key&&"grid-imatge"!==key&&"IMG"===(null==elem?void 0:elem.tagName)&&!(null!=elem&&null!==(_elem$classList=elem.classList)&&void 0!==_elem$classList&&_elem$classList.contains("card-img-top"));return ctx.path&&isImg&&elem&&(ctx.path.targetElement=elem),isImg},title:"Convertir a snippet imatge",onAction:Action.imageSwitchToSnippetAction.bind({ctx:ctx})},changeBoxLanguageNestedMenu={name:"changeBoxLanguage",condition:/capsa-.*|tasca-exercici/,title:"Idioma",subMenuItems:()=>{var _ctx$path4;const elem=null===(_ctx$path4=ctx.path)||void 0===_ctx$path4?void 0:_ctx$path4.elem;if(!elem)return"";const currentLang=elem.getAttribute("data-lang")??"";return SUPPORTED_LANGS.map((_ref=>{let{iso:iso,title:title}=_ref;return{type:"menuitem",text:title,icon:iso===currentLang?"checkmark":void 0,onAction:Action.changeBoxLangAction.bind({ctx:ctx,iso:iso})}}))}},changeBoxSizeNestedMenu={name:"changeBoxSize",condition:/^capsa-.*|^tasca-exercici$/,title:"Mida",subMenuItems:()=>{var _ctx$path5,_ctx$path6,_findVariableByName;const elem=null===(_ctx$path5=ctx.path)||void 0===_ctx$path5?void 0:_ctx$path5.elem,widget=null===(_ctx$path6=ctx.path)||void 0===_ctx$path6?void 0:_ctx$path6.widget;if(!elem||!widget)return"";return((null===(_findVariableByName=(0,_util.findVariableByName)("mida",widget.parameters))||void 0===_findVariableByName?void 0:_findVariableByName.options)||SUPPORTED_SIZES).map((e=>({type:"menuitem",text:e.l??e,icon:elem.classList.contains("iedib-capsa-"+(e.v??e))?"checkmark":void 0,onAction:Action.changeBoxSizeAction.bind({ctx:ctx,size:e.v??e})})))}},changeBoxSeverityNestedMenu={name:"changeBoxSeverity",condition:"capsa-generica",title:"Tipus",subMenuItems:()=>{var _ctx$path7,_ctx$path8,_findVariableByName2;const elem=null===(_ctx$path7=ctx.path)||void 0===_ctx$path7?void 0:_ctx$path7.elem,widget=null===(_ctx$path8=ctx.path)||void 0===_ctx$path8?void 0:_ctx$path8.widget;if(!elem||!widget)return"";return((null===(_findVariableByName2=(0,_util.findVariableByName)("severity",widget.parameters))||void 0===_findVariableByName2?void 0:_findVariableByName2.options)||[]).map((e=>({type:"menuitem",text:e.l??e,icon:elem.classList.contains("iedib-"+(e.v??e)+"-border")?"checkmark":void 0,onAction:Action.changeBoxSeverityAction.bind({ctx:ctx,severity:e.v??e})})))}},twoColumnsNestedMenu={name:"twoColumnsNestedMenu",condition:"two-cols",title:"Mida columnes",subMenuItems:()=>{var _ctx$path9,_ctx$path10,_firstDiv$className;const elem=null===(_ctx$path9=ctx.path)||void 0===_ctx$path9?void 0:_ctx$path9.elem,widget=null===(_ctx$path10=ctx.path)||void 0===_ctx$path10?void 0:_ctx$path10.widget;if(!elem||!widget)return"";const menuItems=[{type:"menuitem",text:"A una columna",onAction:Action.changeColumnWidth.bind({ctx:ctx,colSpan:0})}],firstDiv=elem.querySelector("div:first-child"),firstSpan=firstDiv?((null===(_firstDiv$className=firstDiv.className)||void 0===_firstDiv$className?void 0:_firstDiv$className.split(" "))??[]).filter((c=>c.startsWith("span"))).map((c=>c.replace("span","")))[0]:void 0;for(let i=2;i<12;i+=2){const tpc=parseInt((100*i/12).toFixed(0)),label=tpc+"% | "+(100-tpc)+"%";let isCurrent=firstSpan&&(0,_util.convertInt)(firstSpan,0)==i;menuItems.push({type:"menuitem",text:label,icon:isCurrent?"checkmark":void 0,onAction:Action.changeColumnWidth.bind({ctx:ctx,colSpan:i})})}return menuItems}},switchBoxRowsExample={name:"switchBoxRowsExample",condition:"capsa-exemple-cols",title:"Convertir a exemple 2 files",onAction:Action.switchBoxRowsExampleAction.bind({ctx:ctx})},switchBoxSimpleExample={name:"switchBoxSimpleExample",condition:"capsa-exemple-rows",title:"Convertir a exemple simple",onAction:Action.switchBoxSimpleExampleAction.bind({ctx:ctx})},numberedListNestedMenu={name:"numberedListNestedMenu",condition:()=>{var _ctx$path11;const selectedElement=null===(_ctx$path11=ctx.path)||void 0===_ctx$path11?void 0:_ctx$path11.selectedElement,target=null==selectedElement?void 0:selectedElement.closest("ol");return ctx.path&&target&&(ctx.path.targetElement=target),void 0!==target},icon:"list-num-default",title:"Llista",subMenuItems:()=>{var _ctx$path12,_ctx$path12$targetEle,_ctx$path12$targetEle2;return[{type:"menuitem",text:"Embellit",icon:(null===(_ctx$path12=ctx.path)||void 0===_ctx$path12||null===(_ctx$path12$targetEle=_ctx$path12.targetElement)||void 0===_ctx$path12$targetEle||null===(_ctx$path12$targetEle2=_ctx$path12$targetEle.classList)||void 0===_ctx$path12$targetEle2?void 0:_ctx$path12$targetEle2.contains("iedib-falist"))?"checkmark":void 0,onAction:()=>{var _ctx$path13;const target=null===(_ctx$path13=ctx.path)||void 0===_ctx$path13?void 0:_ctx$path13.targetElement;if(!(target&&target instanceof HTMLElement))return;target.classList.toggle("iedib-falist");const startAt=target.getAttribute("start")||"1";if(target.classList.contains("iedib-falist")){const beginAt=parseInt(startAt);(0,_util.setStyleMCE)(target,"counter-reset","iedibfalist-counter "+(beginAt-1))}else(0,_util.removeStyleMCE)(target,"counter-reset")}},{type:"menuitem",text:"Comença a",onAction:()=>{var _ctx$path14,_ctx$path14$targetEle;const startAt1=(null===(_ctx$path14=ctx.path)||void 0===_ctx$path14||null===(_ctx$path14$targetEle=_ctx$path14.targetElement)||void 0===_ctx$path14$targetEle?void 0:_ctx$path14$targetEle.getAttribute("start"))??"1";openInputDialog("Comença la numeració a ...","",startAt1,(api=>{var _ctx$path15;api.close();const target=null===(_ctx$path15=ctx.path)||void 0===_ctx$path15?void 0:_ctx$path15.targetElement;if(!(target&&target instanceof HTMLElement))return;const startAt2=api.getData().value??"1",beginAt3=(0,_util.convertInt)(startAt2,1);target.setAttribute("start",beginAt3+""),(0,_util.setStyleMCE)(target,"counter-reset","iedibfalist-counter "+(beginAt3-1))}))}}]}},accordionIndependentBehaviorNestedMenu={name:"accordionIndependentBehavior",condition:"desplegable2",title:"Comportament",subMenuItems:()=>{var _ctx$path16;const target=null===(_ctx$path16=ctx.path)||void 0===_ctx$path16?void 0:_ctx$path16.elem;if(!target)return"";const accordionBody=target.querySelector("div.accordion-body"),isDependentBehavior=null!==((null==accordionBody?void 0:accordionBody.getAttribute("data-parent"))??(null==accordionBody?void 0:accordionBody.getAttribute("data-bs-parent"))??null);return[!1,!0].map((opt=>({type:"menuitem",text:opt?"Independents":"Dependents",icon:isDependentBehavior===opt?void 0:"checkmark",onAction:Action.setAccordionBehavior.bind({ctx:ctx,isDependentBehavior:opt})})))}},tablesMaxWidthMenu={name:"tablesMaxWidthMenu",condition:"taula-predefinida,taula-bs",title:"Amplada taula",onAction:()=>{var _ctx$path17;const target=null===(_ctx$path17=ctx.path)||void 0===_ctx$path17?void 0:_ctx$path17.elem;if(!(target&&target instanceof HTMLElement))return;const startAt1=(target.style.getPropertyValue("max-width")||"-1").replace("px","").replace("none","-1");openInputDialog("Amplada màxima en (px)","-1=sense limit",startAt1,(api=>{var _ctx$path18;const target=null===(_ctx$path18=ctx.path)||void 0===_ctx$path18?void 0:_ctx$path18.elem;if(!(target&&target instanceof HTMLElement))return;const maxwidth=(0,_util.convertInt)(api.getData().value.replace("px","").trim(),0);maxwidth>0?(0,_util.setStyleMCE)(target,"max-width",maxwidth+"px"):(0,_util.removeStyleMCE)(target,"max-width"),api.close()}))}},convertToBsTableMenu={name:"convertToBsTableMenu",condition:"taula-predefinida",title:"Convertir a taula Bootstrap",onAction:Action.convert2BootstrapTable.bind({ctx:ctx})},convertToPredefinedTableMenu={name:"convertToPredefinedTableMenu",condition:"taula-bs",title:"Convertir a taula predefinida",onAction:Action.convert2PrefefinedTable.bind({ctx:ctx})},responsivenessNestedMenu={name:"responsivenessNestedMenu",condition:"taula-bs",title:"Responsivitat",subMenuItems:()=>{var _ctx$path19,_target$parentElement;const target=null===(_ctx$path19=ctx.path)||void 0===_ctx$path19?void 0:_ctx$path19.elem;if(!target)return"";return[{type:"menuitem",text:(null===(_target$parentElement=target.parentElement)||void 0===_target$parentElement?void 0:_target$parentElement.classList.contains("table-responsive"))?"Treure":"Afegir",onAction:Action.toggleBootstapTableResponsiveness.bind({ctx:ctx})}]}},tablesHeaderNestedMenu={name:"tablesHeaderNestedMenu",condition:"taula-predefinida,taula-bs",title:"Capçalera",subMenuItems:()=>{var _ctx$path20;const target=null===(_ctx$path20=ctx.path)||void 0===_ctx$path20?void 0:_ctx$path20.elem;if(!target)return"";return[{type:"menuitem",text:null!==target.querySelector("thead")?"Treure":"Afegir",onAction:Action.toggleTableHeader.bind({ctx:ctx})}]}},tablesFooterNestedMenu={name:"tablesFooterNestedMenu",condition:"taula-predefinida,taula-bs",title:"Peu de taula",subMenuItems:()=>{var _ctx$path21;const target=null===(_ctx$path21=ctx.path)||void 0===_ctx$path21?void 0:_ctx$path21.elem;if(!target)return"";return[{type:"menuitem",text:null!==target.querySelector("tfoot")?"Treure":"Afegir",onAction:Action.toggleTableFooter.bind({ctx:ctx})}]}};function colorPicker(editor,cbAccept){const storageSrv=(0,_userstorage_service.getUserStorage)(editor),iniValue=storageSrv.getFromLocal("pickercolor","#FFFFFF");let container,handleClick;editor.windowManager.open({title:"Tria un color",body:{type:"panel",items:[{type:"htmlpanel",html:`<input type="color" id="tiny_ibwidgethub_colorinput" value="${iniValue}" style="width:100%; height:50px;" />\n                    <div id="tiny_ibwidgethub_preset-colors" style="margin: 8px;">\n                        <button type="button" data-color="#BFEDD2" style="background:#BFEDD2; width:24px; height:24px; border:none; margin-right:4px;"></button>\n                        <button type="button" data-color="#FBEEB8" style="background:#FBEEB8; width:24px; height:24px; border:none; margin-right:4px;"></button>\n                        <button type="button" data-color="#F8CAC6" style="background:#F8CAC6; width:24px; height:24px; border:none; margin-right:4px"></button>\n                        <button type="button" data-color="#ECCAFA" style="background:#ECCAFA; width:24px; height:24px; border:none; margin-right:4px;"></button>\n                        <button type="button" data-color="#C2E0F4" style="background:#C2E0F4; width:24px; height:24px; border:none; margin-right:4px;"></button>\n                        <button type="button" data-color="#ECF0F1" style="background:#ECF0F1; width:24px; height:24px; border:none; margin-right:4px"></button>\n                        <button type="button" data-color="#CED4D9" style="background:#CED4D9; width:24px; height:24px; border:none;"></button>\n                    </div>`}]},buttons:[{type:"cancel",text:"Cancel·la"},{type:"submit",text:"Aplica",primary:!0}],onSubmit:api=>{const control=document.getElementById("tiny_ibwidgethub_colorinput");null!=control&&control.value&&(null==cbAccept||cbAccept(control.value),storageSrv.setToLocal("pickercolor",control.value,!0)),api.close(),container&&handleClick&&container.removeEventListener("click",handleClick)}}),setTimeout((()=>{container=document.getElementById("tiny_ibwidgethub_preset-colors"),container&&(handleClick=e=>{const target=e.target.closest("button");if(target){const color=target.dataset.color,input=document.getElementById("tiny_ibwidgethub_colorinput");input&&(input.value=color)}},container.addEventListener("click",handleClick))}),300)}return[imageEffectsNestedMenu,imageSwitchToSnippet,changeBoxLanguageNestedMenu,changeBoxSizeNestedMenu,changeBoxSeverityNestedMenu,switchBoxRowsExample,switchBoxSimpleExample,accordionIndependentBehaviorNestedMenu,numberedListNestedMenu,twoColumnsNestedMenu,{name:"convertDropdownToList",condition:"desplegable2",title:"Convertir a llista",onAction:Action.convertDropdownToList.bind({ctx:ctx})},tablesMaxWidthMenu,convertToBsTableMenu,convertToPredefinedTableMenu,responsivenessNestedMenu,tablesHeaderNestedMenu,tablesFooterNestedMenu,{name:"tablesCellColorNestedMenu",condition:()=>{var _ctx$path22,_ctx$path22$selectedE;return!(null===(_ctx$path22=ctx.path)||void 0===_ctx$path22||null===(_ctx$path22$selectedE=_ctx$path22.selectedElement)||void 0===_ctx$path22$selectedE||!_ctx$path22$selectedE.closest("table"))},title:"Cel·la",subMenuItems:()=>{var _ctx$path23,_ctx$path23$selectedE;const cell=null===(_ctx$path23=ctx.path)||void 0===_ctx$path23||null===(_ctx$path23$selectedE=_ctx$path23.selectedElement)||void 0===_ctx$path23$selectedE?void 0:_ctx$path23$selectedE.closest("td, th");if(!(cell&&cell instanceof HTMLElement))return"";const menus=[{type:"menuitem",text:"Triar fons",onAction:()=>{colorPicker(ctx.editor,(color=>{(0,_util.setStyleMCE)(cell,"background-color",color)}))}}];return cell.style.backgroundColor&&menus.push({type:"menuitem",text:"Eliminar fons",onAction:()=>{(0,_util.removeStyleMCE)(cell,"background-color")}}),menus}},{name:"tablesRowColorNestedMenu",condition:()=>{var _ctx$path24,_ctx$path24$selectedE;return!(null===(_ctx$path24=ctx.path)||void 0===_ctx$path24||null===(_ctx$path24$selectedE=_ctx$path24.selectedElement)||void 0===_ctx$path24$selectedE||!_ctx$path24$selectedE.closest("table"))},title:"Fila",subMenuItems:()=>{var _ctx$path25,_ctx$path25$selectedE;const row=null===(_ctx$path25=ctx.path)||void 0===_ctx$path25||null===(_ctx$path25$selectedE=_ctx$path25.selectedElement)||void 0===_ctx$path25$selectedE?void 0:_ctx$path25$selectedE.closest("tr");if(!(row&&row instanceof HTMLElement))return"";const menus=[{type:"menuitem",text:"Triar fons",onAction:()=>{colorPicker(ctx.editor,(color=>{(0,_util.setStyleMCE)(row,"background-color",color)}))}}];return row.style.backgroundColor&&menus.push({type:"menuitem",text:"Eliminar fons",onAction:()=>{(0,_util.removeStyleMCE)(row,"background-color")}}),menus}}]}))}));

//# sourceMappingURL=contextmenus.min.js.map