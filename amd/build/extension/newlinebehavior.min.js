define("tiny_ibwidgethub/extension/newlinebehavior",["exports"],(function(_exports){
/**
   * Tiny WidgetHub plugin.
   *
   * @module      tiny_ibwidgethub/plugin
   * @copyright   2024 Josep Mulet Pol <pep.mulet@gmail.com>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
function removeEmptyParagraphs(content){if(!content)return"";try{const doc=(new DOMParser).parseFromString(content,"text/html");return doc.querySelectorAll("p").forEach((p=>{if(p.closest("pre, code, script"))return;Array.from(p.childNodes).every((node=>{if(node.nodeType===Node.COMMENT_NODE)return!0;if(node.nodeType===Node.TEXT_NODE){const text=node.textContent||"";return!(text.trim()||/\u00A0/.test(text))}var _node$textContent;return node.nodeType===Node.ELEMENT_NODE&&("SPAN"===node.tagName&&0===node.attributes.length&&!(null!==(_node$textContent=node.textContent)&&void 0!==_node$textContent&&_node$textContent.trim()))}))&&p.remove()})),doc.body.innerHTML}catch(err){return content.replace(/<p>\s*<\/p>/gi,"")}}function padEmptyParagraphsWith(content){let padWith=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"<br>";if(!content)return"";if(!/[<](script|pre|code|!--)/i.test(content))return content.replace(/<p>\s*<\/p>/gi,`<p>${padWith}</p>`);try{const doc=(new DOMParser).parseFromString(content,"text/html");return doc.querySelectorAll("p").forEach((p=>{if(p.closest("pre, code, script"))return;if(Array.from(p.childNodes).every((node=>{if(node.nodeType===Node.COMMENT_NODE)return!0;if(node.nodeType===Node.TEXT_NODE){const text=node.textContent||"";return!(text.trim()||/\u00A0/.test(text))}return!1}))){const comments=Array.from(p.childNodes).filter((n=>n.nodeType===Node.COMMENT_NODE)).map((n=>n.nodeType===Node.COMMENT_NODE?`\x3c!--${n.data}--\x3e`:"")).join("");p.innerHTML=`${padWith}${comments}`}})),doc.body.innerHTML}catch(err){return content.replace(/<p>\s*<\/p>/gi,`<p>${padWith}</p>`)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.emulateAttoNewlineBehaviour=function(editor){editor._orgSetContent||(editor._orgSetContent=editor.setContent,editor.setContent=function(content,args){let processedContent=content;try{args&&"html"!==args.format||(processedContent=removeEmptyParagraphs(content))}catch(err){console.warn("setContent patch failed",err)}return editor._orgSetContent.call(this,processedContent,args)});editor._orgGetContent||(editor._orgGetContent=editor.getContent,editor.getContent=function(){let content=editor._orgGetContent.apply(this,arguments)||"";try{content=padEmptyParagraphsWith(content)}catch(err){console.warn("getContent patch failed",err)}return content})},_exports.padEmptyParagraphsWith=padEmptyParagraphsWith,_exports.removeEmptyParagraphs=removeEmptyParagraphs,_exports.restoreEquationpluginButton=function(editor){var _window;null===(_window=window)||void 0===_window||_window.requirejs(["tiny_equation/common","tiny_equation/equation","tiny_equation/ui"],(function(eqCommon,eqEq,eqUi){"function"==typeof eqUi.handleAction&&(editor.ui.registry.addIcon("tiny_restoreequation",'<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 640 640"><path d="M192 64C156.7 64 128 92.7 128 128L128 512C128 547.3 156.7 576 192 576L448 576C483.3 576 512 547.3 512 512L512 128C512 92.7 483.3 64 448 64L192 64zM224 128L416 128C433.7 128 448 142.3 448 160L448 192C448 209.7 433.7 224 416 224L224 224C206.3 224 192 209.7 192 192L192 160C192 142.3 206.3 128 224 128zM240 296C240 309.3 229.3 320 216 320C202.7 320 192 309.3 192 296C192 282.7 202.7 272 216 272C229.3 272 240 282.7 240 296zM320 320C306.7 320 296 309.3 296 296C296 282.7 306.7 272 320 272C333.3 272 344 282.7 344 296C344 309.3 333.3 320 320 320zM448 296C448 309.3 437.3 320 424 320C410.7 320 400 309.3 400 296C400 282.7 410.7 272 424 272C437.3 272 448 282.7 448 296zM216 416C202.7 416 192 405.3 192 392C192 378.7 202.7 368 216 368C229.3 368 240 378.7 240 392C240 405.3 229.3 416 216 416zM344 392C344 405.3 333.3 416 320 416C306.7 416 296 405.3 296 392C296 378.7 306.7 368 320 368C333.3 368 344 378.7 344 392zM424 416C410.7 416 400 405.3 400 392C400 378.7 410.7 368 424 368C437.3 368 448 378.7 448 392C448 405.3 437.3 416 424 416zM192 488C192 474.7 202.7 464 216 464L328 464C341.3 464 352 474.7 352 488C352 501.3 341.3 512 328 512L216 512C202.7 512 192 501.3 192 488zM424 464C437.3 464 448 474.7 448 488C448 501.3 437.3 512 424 512C410.7 512 400 501.3 400 488C400 474.7 410.7 464 424 464z"/></svg>'),editor.ui.registry.addToggleButton("tiny_restoreequation",{icon:"tiny_restoreequation",tooltip:eqCommon.buttonText,onAction:()=>{eqUi.handleAction(editor)},onSetup:api=>{editor.on("NodeChange",(()=>{const result=eqEq.getSelectedEquation(editor);api.setActive(result)}))}}))}))}}));

//# sourceMappingURL=newlinebehavior.min.js.map